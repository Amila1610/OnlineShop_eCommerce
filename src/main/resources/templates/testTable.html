<!DOCTYPE html>
<html>
    <head>
        <title>Products</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
              integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css"
              integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
        <link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.19.1/dist/bootstrap-table.min.css">
    </head>
    <body>

        <h2>Products</h2>

        <nav class="navbar navbar-expand-lg navbar-dark" style="background-color:#4527A0;">

            <div class="container">
                <a class="navbar-brand" href="/">
                    <img src="/resources/static/css/logoo.png" alt="" width="30" height="30">
                </a>
                <a href="/" class="navbar-brand"> click<span class="text-warning">SHOP</span> </a>
                <div class="collapse navbar-collapse" id="navmenu" style="color:#f0ad4e;">
                    Products
                </div>
            </div>
        </nav>


        <!-- ADD Modal -->
        <div class="modal fade" id="add" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Insert New Product</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <form action="/product/add" method="POST" class="needs-validation" novalidate>

                        <div class="modal-body">

                            <div class="mb-3">
                                <label for="name" class="form-label">Enter product name: </label>
                                <input type="text" name="name" class="form-control" id="name" placeholder="Enter name" required pattern="[A-ZČĆŽŠĐ][A-ZČĆŽŠĐa-z šđčćž]+">
                                <div class="invalid-feedback">Field should only be alphabetical and start with capital letter</div>
                            </div>
                            <div class="mb-3">
                                <label for="description" class="form-label">Enter product description: </label>
                                <input type="text" name="description" class="form-control" id="description"
                                       placeholder="Enter description">
                            </div>
                            <div class="mb-3">
                                <label for="price" class="form-label">Enter product price: </label>
                                <input type="number" name="price" class="form-control" id="price"
                                       placeholder="Enter price" required min="0" value="0" step="0.01">
                                <div class="invalid-feedback">Field should only contain numbers</div>
                            </div>
                            <div class="mb-3">
                                <label for="quantity" class="form-label">Enter quantity: </label>
                                <input type="number" name="quantity" class="form-control" id="quantity"
                                       placeholder="Enter quantity" required>
                                <div class="invalid-feedback">Field should only contain numbers</div>
                            </div>
                            <div class="mb-3">
                                <label for="category" class="form-label">Select category:</label>
                                <select id="category" class="form-control form-control-lg" name="category" data-live-search="true">
                                    <option th:each="category:${categories}"  
                                            th:value="${category.idproductCategory}"
                                            th:text="${category.name}">
                                    </option>
                                </select>
                                <div class="invalid-feedback">Please select product category</div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                Close
                            </button>
                            <button type="submit" class="btn btn-primary" value="Save" id="save_button" name="save_button">
                                Submit new product
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="p-2 container-add" id="toolbar">
            <button id="addModal" class=" btn btn-success float-right" data-bs-toggle="modal" data-bs-target="#add"
                    data-align="right">Add New Product
            </button>
        </div>

        <!-- EDIT Modal -->
        <div class="modal fade" id="edit" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Edit Product</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <form action="/product/update" method="PUT" class="needs-validation" novalidate>
                        <div class="modal-body">
                            <div class="mb-3">
                                <label for="editName" class="form-label">Edit Product Name: </label>
                                <input type="text" name="name" class="form-control" id="editName" placeholder="Edit name">
                            </div>
                            <div class="mb-3">
                                <label for="editDescription" class="form-label">Edit Category Description: </label>
                                <input type="text" name="description" class="form-control" id="editDescription" placeholder="Edit description">
                            </div>
                            <div class="mb-3">
                                <label for="editPrice" class="form-label">Edit Product Price: </label>
                                <input type="number" name="price" class="form-control" id="editPrice" placeholder="Edit price">
                            </div>
                            <div class="mb-3">
                                <label for="editQuantity" class="form-label">Edit Quantity: </label>
                                <input type="number" name="quantity" class="form-control" id="editQuantity" placeholder="Edit quantity">
                            </div>
                            <div class="mb-3">
                                <label for="editCategory" class="form-label">Edit Product category: </label>
                                <input type="text" name="category" class="form-control" id="editCategory" placeholder="Edit category">
                            </div>
                            <div class="mb-3">
                                <label for="editDiscount" class="form-label">Edit discount: </label>
                                <select id="editDiscount" class="form-control form-control-lg" name="discount">
                                    <option selected disabled value="">Select discount</option>
                                    <option th:each="discount:${discounts}"  
                                            th:value="${discount.iddiscount}"
                                            th:text="${discount.discountPercent}">
                                    </option>
                                </select>
                                <div class="invalid-feedback">Please select option</div>
                            </div>
                            <div class="mb-3">
                                <label for="editActive" class="form-label">Product Active?: </label>
                                <input type="number" name="active" class="form-control" id="editActive" placeholder="Edit Active">
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                Close
                            </button>
                            <button type="submit" class="btn btn-primary">
                                Save changes
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <table id="product"
               data-toggle="table"
               data-url="http://localhost:8080/product/getproduct"
               data-pagination="true"
               data-search="true"
               data-search-align="left">
            <thead>
                <tr>
                    <th data-field="idproduct" data-align="center">ID</th>
                    <th data-field="name" data-align="center">Name</th>
                    <th data-field="description" data-align="center">Description</th>
                    <th data-field="price" data-align="center">Price</th>
                    <th data-field="discount" data-align="center">Discount</th>
                    <th data-field="quantity" data-align="center">Quantity</th>
                    <th data-field="active" data-align="center">Active</th>
                    <th data-field="custom" data-events="window.operateEvents" data-align="center" data-formatter="optionFormat">
                        Options
                    </th>
                </tr>
            </thead>
        </table>

    </body>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
            integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
    crossorigin="anonymous"></script>
    <script src="https://unpkg.com/bootstrap-table@1.19.1/dist/bootstrap-table.min.js"></script>
    <script>
        var $edit = $('edit');
        function optionFormat(value, row) {
            return [
                '<button id="addEditModal"  class="btn btn-success edit" data-bs-toggle="modal" data-bs-target="#edit" title="Edit">',
                '<i class="far fa-eye" ></i> ',
                '</button>',

                '<a class="btn btn-danger remove" href="javascript:void(0)" title="Remove">',
                '<i class="fa fa-trash"></i>',
                '</a>'

            ].join('')
        }



        window.operateEvents = {
            'click .remove': function (e, value, row) {
                if (confirm('Are you sure you want to delete this?')) {
                    $.ajax({
                        type: "DELETE",
                        url: "/product/products/delete/" + row.idproduct,
                        headers: {'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')},
                        success: function (content) {
                            $('#alert').html(content)
                            $('#product').bootstrapTable('refresh')
                        },
                        error: function (error) {
                            console.log(error + " " + JSON.stringify(row));
                        }
                    });
                }
            },
            'click .edit': function (e, value, row) {
                $.ajax({
                    type: "PUT",
                    url: "/product/update",
                    headers: {'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')},
                    success: function (content) {
                        $('#alert').html(content)
                        $('#product').bootstrapTable('refresh')
                    },
                    error: function (error) {
                        console.log(error + " " + JSON.stringify(row));
                    }
                });
            }
        }

        $('#addEditModal').click(function () {

        });

        (function () {
            'use strict'

            // Fetch all the forms we want to apply custom Bootstrap validation styles to
            var forms = document.querySelectorAll('.needs-validation')

            // Loop over them and prevent submission
            Array.prototype.slice.call(forms)
                    .forEach(function (form) {
                        form.addEventListener('submit', function (event) {
                            if (!form.checkValidity()) {
                                event.preventDefault()
                                event.stopPropagation()
                            }

                            form.classList.add('was-validated')
                        }, false)
                    })
        })()
    </script>
</html>
